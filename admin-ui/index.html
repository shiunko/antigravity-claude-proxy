<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Antigravity Proxy Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <link rel="stylesheet" href="css/admin.css">
</head>
<body class="bg-gray-100 min-h-screen" x-data="app()" x-init="init()">

  <!-- Login Page -->
  <div x-show="!isAuthenticated" class="min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
      <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">
        Antigravity Proxy
      </h1>

      <!-- Tab Navigation -->
      <div class="flex mb-6 border-b">
        <button
          @click="authTab = 'login'"
          :class="authTab === 'login' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
          class="flex-1 py-2 px-4 border-b-2 font-medium transition-colors">
          登录
        </button>
        <button
          @click="authTab = 'register'"
          :class="authTab === 'register' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
          class="flex-1 py-2 px-4 border-b-2 font-medium transition-colors">
          注册
        </button>
      </div>

      <!-- Login Form -->
      <form x-show="authTab === 'login'" @submit.prevent="login()" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
          <input type="text" x-model="loginForm.username" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
          <input type="password" x-model="loginForm.password" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div x-show="loginError" class="text-red-500 text-sm" x-text="loginError"></div>
        <button type="submit" :disabled="isLoading"
          class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors">
          <span x-show="!isLoading">登录</span>
          <span x-show="isLoading">登录中...</span>
        </button>
      </form>

      <!-- Register Form -->
      <form x-show="authTab === 'register'" @submit.prevent="register()" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
          <input type="text" x-model="registerForm.username" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
          <input type="password" x-model="registerForm.password" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">确认密码</label>
          <input type="password" x-model="registerForm.confirmPassword" required
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div x-show="registerError" class="text-red-500 text-sm" x-text="registerError"></div>
        <div x-show="registerSuccess" class="text-green-500 text-sm" x-text="registerSuccess"></div>
        <button type="submit" :disabled="isLoading"
          class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:opacity-50 transition-colors">
          <span x-show="!isLoading">注册</span>
          <span x-show="isLoading">注册中...</span>
        </button>
      </form>
    </div>
  </div>

  <!-- Main Application -->
  <div x-show="isAuthenticated" class="flex min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 text-white flex-shrink-0">
      <div class="p-4 border-b border-gray-700">
        <h1 class="text-xl font-bold">Antigravity Proxy</h1>
        <p class="text-sm text-gray-400 mt-1" x-text="currentUser?.username"></p>
      </div>
      <nav class="p-4">
        <ul class="space-y-2">
          <li>
            <a href="#" @click.prevent="currentPage = 'dashboard'"
              :class="currentPage === 'dashboard' ? 'bg-gray-700' : 'hover:bg-gray-700'"
              class="flex items-center px-4 py-2 rounded-md transition-colors">
              <span class="mr-3">📊</span> 仪表盘
            </a>
          </li>
          <li>
            <a href="#" @click.prevent="currentPage = 'accounts'"
              :class="currentPage === 'accounts' ? 'bg-gray-700' : 'hover:bg-gray-700'"
              class="flex items-center px-4 py-2 rounded-md transition-colors">
              <span class="mr-3">🔑</span> 账户管理
            </a>
          </li>
          <li>
            <a href="#" @click.prevent="currentPage = 'groups'"
              :class="currentPage === 'groups' ? 'bg-gray-700' : 'hover:bg-gray-700'"
              class="flex items-center px-4 py-2 rounded-md transition-colors">
              <span class="mr-3">📦</span> 模型组
            </a>
          </li>
          <li x-show="currentUser?.is_admin">
            <a href="#" @click.prevent="currentPage = 'users'"
              :class="currentPage === 'users' ? 'bg-gray-700' : 'hover:bg-gray-700'"
              class="flex items-center px-4 py-2 rounded-md transition-colors">
              <span class="mr-3">👤</span> 用户管理
            </a>
          </li>
          <li>
            <a href="#" @click.prevent="currentPage = 'settings'"
              :class="currentPage === 'settings' ? 'bg-gray-700' : 'hover:bg-gray-700'"
              class="flex items-center px-4 py-2 rounded-md transition-colors">
              <span class="mr-3">⚙️</span> 设置
            </a>
          </li>
        </ul>
      </nav>
      <div class="absolute bottom-0 w-64 p-4 border-t border-gray-700">
        <button @click="logout()" class="w-full text-left px-4 py-2 text-gray-400 hover:text-white transition-colors">
          退出登录
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-auto">
      <!-- Dashboard Page -->
      <div x-show="currentPage === 'dashboard'" x-data="dashboardComponent()">
        <h2 class="text-2xl font-bold mb-6">仪表盘</h2>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="bg-white p-6 rounded-lg shadow">
            <div class="text-3xl font-bold text-blue-600" x-text="stats.totalAccounts">0</div>
            <div class="text-gray-500">总账户数</div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <div class="text-3xl font-bold text-green-600" x-text="stats.activeAccounts">0</div>
            <div class="text-gray-500">正常账户</div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <div class="text-3xl font-bold text-yellow-600" x-text="stats.rateLimitedAccounts">0</div>
            <div class="text-gray-500">限流账户</div>
          </div>
          <div class="bg-white p-6 rounded-lg shadow">
            <div class="text-3xl font-bold text-red-600" x-text="stats.invalidAccounts">0</div>
            <div class="text-gray-500">无效账户</div>
          </div>
        </div>

        <!-- API Key Display -->
        <div class="bg-white p-6 rounded-lg shadow mb-8">
          <h3 class="text-lg font-semibold mb-4">你的 API Key</h3>
          <div class="flex items-center space-x-4">
            <code class="flex-1 bg-gray-100 px-4 py-2 rounded font-mono text-sm" x-text="showApiKey ? currentUser?.api_key : '••••••••••••••••••••••••'"></code>
            <button @click="showApiKey = !showApiKey" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
              <span x-text="showApiKey ? '隐藏' : '显示'"></span>
            </button>
            <button @click="copyApiKey()" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
              复制
            </button>
          </div>
        </div>

        <!-- Model Groups Overview -->
        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4">模型组</h3>
          <div x-show="modelGroups.length === 0" class="text-gray-500">
            暂无模型组，<a href="#" @click.prevent="$dispatch('navigate', 'groups')" class="text-blue-600 hover:underline">点击创建</a>
          </div>
          <div class="space-y-2">
            <template x-for="group in modelGroups" :key="group.id">
              <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                <div>
                  <span class="font-medium" x-text="group.alias"></span>
                  <span class="text-gray-500 text-sm ml-2" x-text="'(' + group.strategy + ')'"></span>
                </div>
                <span class="text-gray-500 text-sm" x-text="group.items?.length + ' 个模型'"></span>
              </div>
            </template>
          </div>
        </div>
      </div>

      <!-- Accounts Page -->
      <div x-show="currentPage === 'accounts'" x-data="accountsComponent()">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">账户管理</h2>
          <div class="space-x-2">
            <button @click="refreshAccounts()" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
              刷新
            </button>
            <button @click="showAddModal = true" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
              + 添加账户
            </button>
          </div>
        </div>

        <!-- Accounts List -->
        <div class="space-y-4">
          <template x-for="account in accounts" :key="account.id">
            <div class="bg-white p-6 rounded-lg shadow">
              <div class="flex items-start justify-between">
                <div class="flex items-center">
                  <span x-show="!account.is_invalid && !account.is_rate_limited" class="text-2xl mr-3">✅</span>
                  <span x-show="account.is_rate_limited" class="text-2xl mr-3">⚠️</span>
                  <span x-show="account.is_invalid" class="text-2xl mr-3">❌</span>
                  <div>
                    <div class="font-semibold text-lg" x-text="account.email"></div>
                    <div class="text-gray-500 text-sm">
                      来源: <span x-text="account.source"></span> |
                      项目: <span x-text="account.project_id || '未知'"></span>
                    </div>
                  </div>
                </div>
                <div class="space-x-2">
                  <button @click="verifyAccount(account)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm transition-colors">
                    验证
                  </button>
                  <button @click="deleteAccount(account)" class="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm transition-colors">
                    删除
                  </button>
                </div>
              </div>
              <div class="mt-2 text-sm">
                <span x-show="account.is_rate_limited" class="text-yellow-600">
                  限流中 (重置时间: <span x-text="formatTime(account.rate_limit_reset_time)"></span>)
                </span>
                <span x-show="account.is_invalid" class="text-red-600">
                  无效: <span x-text="account.invalid_reason"></span>
                </span>
                <span x-show="!account.is_invalid && !account.is_rate_limited" class="text-green-600">
                  状态正常
                </span>
                <span class="text-gray-400 ml-4" x-show="account.last_used">
                  上次使用: <span x-text="formatTime(account.last_used)"></span>
                </span>

                <!-- Quota Display -->
                <div class="mt-2 pt-2 border-t border-gray-100"
                     x-data="{ limits: [] }"
                     x-effect="limits = getLimitInfo(account.email)"
                     x-show="limits.length > 0">
                  <div class="flex flex-col gap-2">
                    <template x-for="limit in limits" :key="limit.model">
                      <div class="flex items-center text-sm">
                        <span class="text-gray-500 mr-2 w-16">📊 配额:</span>
                        <span class="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-600 mr-2 w-48 truncate" x-text="limit.model" :title="limit.model"></span>

                        <div class="flex-1 max-w-xs bg-gray-200 rounded-full h-2 mr-2 overflow-hidden">
                          <div class="h-2 rounded-full transition-all duration-500"
                               :class="{
                                 'bg-green-500': limit.remainingFraction !== null && limit.remainingFraction > 0.5,
                                 'bg-yellow-500': limit.remainingFraction !== null && limit.remainingFraction <= 0.5 && limit.remainingFraction > 0.2,
                                 'bg-red-500': limit.remainingFraction !== null && limit.remainingFraction <= 0.2,
                                 'bg-gray-400': limit.remainingFraction === null
                               }"
                               :style="'width: ' + ((limit.remainingFraction || 0) * 100) + '%'"></div>
                        </div>

                        <span class="font-medium min-w-[3rem]" x-text="limit.remaining"></span>

                        <span class="text-gray-400 text-xs ml-2" x-show="limit.resetTime">
                          (重置: <span x-text="new Date(limit.resetTime).toLocaleTimeString()"></span>)
                        </span>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <div x-show="accounts.length === 0" class="bg-white p-8 rounded-lg shadow text-center text-gray-500">
            暂无账户，点击上方"添加账户"按钮添加
          </div>
        </div>

        <!-- Add Account Modal -->
        <div x-show="showAddModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-lg p-6 w-full max-w-md" @click.away="showAddModal = false">
            <h3 class="text-xl font-bold mb-4">添加 Google 账户</h3>

            <!-- Add Method Tabs -->
            <div class="flex mb-4 border-b">
              <button @click="addMethod = 'oauth'"
                :class="addMethod === 'oauth' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="flex-1 py-2 px-4 border-b-2 font-medium transition-colors">
                🔐 OAuth 登录
              </button>
              <button @click="addMethod = 'manual'"
                :class="addMethod === 'manual' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                class="flex-1 py-2 px-4 border-b-2 font-medium transition-colors">
                📝 手动输入
              </button>
            </div>

            <!-- OAuth Method -->
            <div x-show="addMethod === 'oauth'" class="space-y-4">
              <p class="text-gray-600 text-sm">
                点击下方按钮开始 Google OAuth 登录流程。授权完成后，账户将自动添加。
              </p>
              <button @click="startOAuth()" :disabled="oauthLoading"
                class="w-full bg-blue-600 text-white py-3 px-4 rounded-md hover:bg-blue-700 disabled:opacity-50 transition-colors">
                <span x-show="!oauthLoading">🔐 开始 OAuth 登录</span>
                <span x-show="oauthLoading">等待授权中...</span>
              </button>
            </div>

            <!-- Manual Method -->
            <div x-show="addMethod === 'manual'" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
                <input type="email" x-model="manualForm.email" required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Refresh Token</label>
                <textarea x-model="manualForm.refresh_token" rows="3" required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">项目 ID (可选)</label>
                <input type="text" x-model="manualForm.project_id"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <button @click="addManualAccount()" :disabled="isLoading"
                class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:opacity-50 transition-colors">
                添加账户
              </button>
            </div>

            <div x-show="addError" class="mt-4 text-red-500 text-sm" x-text="addError"></div>

            <button @click="showAddModal = false" class="mt-4 w-full py-2 text-gray-500 hover:text-gray-700 transition-colors">
              取消
            </button>
          </div>
        </div>
      </div>

      <!-- Model Groups Page -->
      <div x-show="currentPage === 'groups'" x-data="groupsComponent()">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">模型组管理</h2>
          <button @click="showCreateModal = true" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
            + 创建模型组
          </button>
        </div>

        <!-- Groups List -->
        <div class="space-y-4">
          <template x-for="group in groups" :key="group.id">
            <div class="bg-white p-6 rounded-lg shadow">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <span class="text-xl mr-2">📦</span>
                  <span class="font-semibold text-lg" x-text="group.alias"></span>
                  <span class="ml-2 px-2 py-1 bg-gray-100 rounded text-sm" x-text="'策略: ' + group.strategy"></span>
                </div>
                <div class="space-x-2">
                  <button @click="editGroup(group)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300 text-sm transition-colors">
                    编辑
                  </button>
                  <button @click="deleteGroup(group)" class="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 text-sm transition-colors">
                    删除
                  </button>
                </div>
              </div>
              <div class="pl-8 space-y-1">
                <template x-for="(item, index) in group.items" :key="item.id">
                  <div class="flex items-center justify-between py-1 text-sm">
                    <span>
                      <span class="text-gray-400" x-text="(index + 1) + '.'"></span>
                      <span x-text="item.model_name"></span>
                    </span>
                    <button @click="removeModelFromGroup(group, item.model_name)" class="text-red-500 hover:text-red-700 transition-colors">
                      ✕
                    </button>
                  </div>
                </template>
                <button @click="showAddModelModal(group)" class="text-blue-600 hover:text-blue-800 text-sm transition-colors">
                  + 添加模型
                </button>
              </div>
            </div>
          </template>
          <div x-show="groups.length === 0" class="bg-white p-8 rounded-lg shadow text-center text-gray-500">
            暂无模型组，点击上方"创建模型组"按钮创建
          </div>
        </div>

        <!-- Create Group Modal -->
        <div x-show="showCreateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-lg p-6 w-full max-w-md" @click.away="showCreateModal = false">
            <h3 class="text-xl font-bold mb-4">创建模型组</h3>
            <form @submit.prevent="createGroup()" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">别名</label>
                <input type="text" x-model="createForm.alias" required placeholder="例如: gemini-2-pro"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">策略</label>
                <select x-model="createForm.strategy"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                  <option value="priority">priority (按顺序优先)</option>
                  <option value="random">random (随机选择)</option>
                </select>
              </div>
              <div x-show="createError" class="text-red-500 text-sm" x-text="createError"></div>
              <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                创建
              </button>
            </form>
            <button @click="showCreateModal = false" class="mt-4 w-full py-2 text-gray-500 hover:text-gray-700 transition-colors">
              取消
            </button>
          </div>
        </div>

        <!-- Add Model to Group Modal -->
        <div x-show="addModelModal.show" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-lg p-6 w-full max-w-md" @click.away="addModelModal.show = false">
            <h3 class="text-xl font-bold mb-4">添加模型到 <span x-text="addModelModal.group?.alias"></span></h3>
            <form @submit.prevent="addModelToGroup()" class="space-y-4">
              <div x-data="{ mode: 'select' }">
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  模型名称
                  <button type="button" @click="mode = mode === 'select' ? 'manual' : 'select'" class="text-xs text-blue-500 ml-2 hover:underline focus:outline-none">
                    <span x-text="mode === 'select' ? '切换到手动输入' : '切换到列表选择'"></span>
                  </button>
                </label>

                <select x-show="mode === 'select'" x-model="addModelModal.modelName"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white">
                  <option value="">请选择模型...</option>
                  <template x-for="model in availableModels" :key="model">
                    <option :value="model" x-text="model"></option>
                  </template>
                </select>

                <input x-show="mode === 'manual'" type="text" x-model="addModelModal.modelName" placeholder="例如: gemini-2.0-flash-exp"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">顺序 (数字越小优先级越高)</label>
                <input type="number" x-model="addModelModal.orderIndex" min="0"
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                添加
              </button>
            </form>
            <button @click="addModelModal.show = false" class="mt-4 w-full py-2 text-gray-500 hover:text-gray-700 transition-colors">
              取消
            </button>
          </div>
        </div>
      </div>

      <!-- Users Page (Admin Only) -->
      <div x-show="currentPage === 'users'" x-data="usersComponent()">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold">用户管理</h2>
          <button @click="showCreateModal = true" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
            + 创建用户
          </button>
        </div>

        <!-- Users List -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
          <table class="w-full">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">用户名</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">API Key</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">创建时间</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">角色</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">操作</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <template x-for="user in users" :key="user.id">
                <tr>
                  <td class="px-6 py-4 whitespace-nowrap" x-text="user.username"></td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <code class="text-sm bg-gray-100 px-2 py-1 rounded" x-text="user.api_key?.substring(0, 20) + '...'"></code>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(user.created_at)"></td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span x-show="user.is_admin" class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">管理员</span>
                    <span x-show="!user.is_admin" class="px-2 py-1 bg-gray-100 text-gray-800 rounded text-xs">普通用户</span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap space-x-2">
                    <button @click="regenerateKey(user)" class="text-blue-600 hover:text-blue-800 text-sm">重置 Key</button>
                    <button @click="deleteUser(user)" class="text-red-600 hover:text-red-800 text-sm">删除</button>
                  </td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>

        <!-- Create User Modal -->
        <div x-show="showCreateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div class="bg-white rounded-lg p-6 w-full max-w-md" @click.away="showCreateModal = false">
            <h3 class="text-xl font-bold mb-4">创建用户</h3>
            <form @submit.prevent="createUser()" class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">用户名</label>
                <input type="text" x-model="createForm.username" required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">密码</label>
                <input type="password" x-model="createForm.password" required
                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
              </div>
              <div class="flex items-center">
                <input type="checkbox" x-model="createForm.is_admin" id="is_admin" class="mr-2">
                <label for="is_admin" class="text-sm text-gray-700">设为管理员</label>
              </div>
              <div x-show="createError" class="text-red-500 text-sm" x-text="createError"></div>
              <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
                创建
              </button>
            </form>
            <button @click="showCreateModal = false" class="mt-4 w-full py-2 text-gray-500 hover:text-gray-700 transition-colors">
              取消
            </button>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div x-show="currentPage === 'settings'" x-data="settingsComponent()">
        <h2 class="text-2xl font-bold mb-6">设置</h2>

        <div class="bg-white p-6 rounded-lg shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">修改密码</h3>
          <form @submit.prevent="changePassword()" class="space-y-4 max-w-md">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">当前密码</label>
              <input type="password" x-model="passwordForm.currentPassword" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">新密码</label>
              <input type="password" x-model="passwordForm.newPassword" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">确认新密码</label>
              <input type="password" x-model="passwordForm.confirmPassword" required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div x-show="passwordError" class="text-red-500 text-sm" x-text="passwordError"></div>
            <div x-show="passwordSuccess" class="text-green-500 text-sm" x-text="passwordSuccess"></div>
            <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">
              修改密码
            </button>
          </form>
        </div>

        <div class="bg-white p-6 rounded-lg shadow">
          <h3 class="text-lg font-semibold mb-4">API 配置</h3>
          <div class="space-y-2 text-sm">
            <p><span class="text-gray-500">Anthropic API 端点:</span> <code class="bg-gray-100 px-2 py-1 rounded" x-text="apiBaseUrl + '/v1/messages'"></code></p>
            <p><span class="text-gray-500">OpenAI API 端点:</span> <code class="bg-gray-100 px-2 py-1 rounded" x-text="apiBaseUrl + '/v1/chat/completions'"></code></p>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="js/api.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
